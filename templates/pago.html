<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Fuente -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Menu para moviles -->
    <script src="{{ url_for('static', filename='js/menu.js') }}"></script>
    <!-- CHATBOT -->
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
    <script type="module" src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <!-- Icono del Hotel -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/ico_Hotel_Maliche.ico') }}">
    <title>Pago | Hotel El Malinche</title>
  <!-- SDK de PayPal -->
  <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD"></script>
</head>

<body class="bg-gray-50 font-[Rubik]">
  <!-- HEADER -->
<header class="flex items-center justify-between p-4 bg-[#121212] shadow-md relative">
  <!-- LOGO -->
  <div class="flex items-center gap-2">
    <img src="{{ url_for('static', filename='images/logo_hotel_malinche.png') }}" alt="Hotel El Malinche" class="w-12 h-12">
    <span class="text-xl text-white font-bold">Hotel El Malinche</span>
  </div>

  <!-- BOTÓN HAMBURGUESA (visible solo en móvil) -->
  <button class="text-3xl text-white md:hidden focus:outline-none" id="menu-btn">
    ☰
  </button>

  <!-- NAVEGACIÓN -->
  <nav id="menu" class="hidden md:flex flex-col md:flex-row items-center md:gap-6 absolute md:static top-[70px] left-0 w-full md:w-auto bg-[#121212] md:bg-transparent z-40">
    <a href="/" class="text-white hover:text-[#8B3F41] py-2 px-4 md:p-0">Inicio</a>
    <a href="/servicios" class="text-white hover:text-[#8B3F41] py-2 px-4 md:p-0">Servicios</a>
    <a href="/nosotros" class="text-white hover:text-[#8B3F41] py-2 px-4 md:p-0">Nosotros</a>
    <a href="/habitaciones" class="text-white hover:text-[#8B3F41] py-2 px-4 md:p-0">Habitaciones</a>
    <a href="/contacto" class="text-white hover:text-[#8B3F41] py-2 px-4 md:p-0">Contacto</a>
    <a href="/habitaciones" class="bg-[#8B3F41] hover:bg-[#4E342E] text-white px-6 py-2 rounded-lg shadow-md transition my-3 md:my-0">
      Reserva
    </a>
  </nav>
</header>

  <main class="max-w-2xl mx-auto mt-10 bg-white rounded-2xl shadow-lg p-8">
    <h2 class="text-3xl font-bold text-[#8B3F41] text-center mb-6">Confirmar Pago</h2>

    <!-- Información de la habitación -->
    <div class="border border-gray-200 rounded-lg p-6 mb-8">
      <p class="text-gray-700"><strong>Habitación:</strong> {{ habitacion.Nombre_TipoHab }}</p>
      <p class="text-gray-700"><strong>Descripción:</strong> {{ habitacion.Descripcion_Habitacion }}</p>
      <p class="text-gray-700"><strong>Precio:</strong> ${{ habitacion.Precio_Habitacion }} USD</p>
      <p class="text-sm text-gray-500 mt-2">
        Al completar el pago, recibirás un correo con los detalles de tu reserva.
      </p>
    </div>
<section class="max-w-xl mx-auto bg-white shadow-lg rounded-xl p-8 mt-10 border border-gray-200">
  <h2 class="text-2xl font-bold text-[#8B3F41] mb-6 text-center">Completa tu Reserva</h2>

    <form id="reservaForm" class="space-y-4">
    <div>
      <label for="nombre" class="block text-gray-700 font-medium">Nombre Completo</label>
      <input type="text" id="nombre" name="nombre" required
             class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-[#8B3F41]" />
    </div>

    <div>
      <label for="cedula" class="block text-gray-700 font-medium">Cédula</label>
      <input type="text" id="cedula" name="cedula" required
             class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-[#8B3F41]" />
    </div>

    <div>
      <label for="correo" class="block text-gray-700 font-medium">Correo Electrónico</label>
      <input type="email" id="correo" name="correo" required
             class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-[#8B3F41]" />
    </div>

    <div>
  <label for="checkin" class="block text-gray-700 font-medium">Fecha de Check-In</label>
  <input type="date" id="checkin" name="checkin" required
         class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-[#8B3F41]" />
</div>

<div>
  <label for="checkout" class="block text-gray-700 font-medium">Fecha de Check-Out</label>
  <input type="date" id="checkout" name="checkout" required
         class="w-full border border-gray-300 rounded-lg p-2 focus:ring focus:ring-[#8B3F41]" />
</div>

    <button type="button" id="continuarBtn"
            class="bg-[#8B3F41] hover:bg-[#4E342E] text-white px-6 py-2 rounded-lg w-full mt-4 font-semibold transition-all duration-300">
      Continuar con el pago
    </button>
  </form>
    <!-- Botón PayPal -->
    <div id="paypal-container" class="hidden mt-8">
    <div id="paypal-button-container"></div>
    </div>

    <!-- Mensajes -->
    <div id="payment-message" class="hidden mt-6 text-center text-sm p-3 rounded-lg"></div>

    <a href="/" class="block text-center mt-8 text-[#8B3F41] hover:underline">Volver al inicio</a>
  </main>
  <br>

    <!-- FOOTER -->
<section class="px-6 py-12 text-center bg-white">
  <h1 class="text-2xl font-bold">Suscríbete</h1>
  <p class="text-gray-600 mt-2">Recibe notificaciones de descuentos y promociones.</p>

  <form method="POST" action="/subscribe" class="mt-4 flex justify-center gap-2">
    <input type="email" name="email" placeholder="Ingresa tu correo" required
           class="border px-4 py-2 rounded-lg w-64 focus:ring focus:ring-blue-300">
    <button type="submit" class="bg-[#8B3F41] text-white px-6 py-2 rounded-lg hover:bg-[#4E342E]">
      Suscríbeme
    </button>
  </form>

</section>
  <footer class="text-center py-6 bg-[#8B3F41] text-white mt-10">
    © 2025 Hotel El Malinche. Todos los derechos reservados.
  </footer>

  <script>
  document.getElementById("continuarBtn").addEventListener("click", function () {
    const nombre = document.getElementById("nombre").value.trim();
    const cedula = document.getElementById("cedula").value.trim();
    const correo = document.getElementById("correo").value.trim();
    const checkin = document.getElementById("checkin").value.trim();
    const checkout = document.getElementById("checkout").value.trim();

    // Validación
    if (!nombre || !cedula || !correo || !checkin || !checkout) {
  alert("⚠️ Por favor, completa todos los campos antes de continuar con el pago.");
  return;
}

    // Mostrar PayPal
    document.getElementById("paypal-container").classList.remove("hidden");
    this.disabled = true;

    paypal.Buttons({
      style: { layout: 'vertical', color: 'gold', shape: 'pill', label: 'paypal' },

      // Crear orden
      createOrder: function () {
        return fetch('/create-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            habitacion_id: "{{ habitacion.Id_Tipo_Habitacion }}",
            descripcion: "{{ habitacion.Nombre_TipoHab }}",
            monto: "{{ habitacion.Precio_Habitacion }}",
            nombre: nombre,
            cedula: cedula,
            correo: correo,
            checkin: checkin,
            checkout: checkout
          })
        })
        .then(res => res.json())
        .then(data => data.id);
      },

      // Capturar orden
      onApprove: function (data) {
        return fetch('/capture-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            orderID: data.orderID,
            nombre: nombre,
            cedula: cedula,
            correo: correo,
            descripcion: "{{ habitacion.Nombre_TipoHab }}",
            checkin: checkin,
            checkout: checkout
          })
        })
        .then(res => res.json())
        .then(data => {
          document.getElementById("payment-message").classList.remove("hidden");
          document.getElementById("payment-message").innerHTML =
            "✅ ¡Pago completado exitosamente! Se ha enviado una confirmación a tu correo.";
        });
      },

      onError: function () {
        alert("Ocurrió un error con PayPal. Por favor, inténtalo nuevamente.");
      }

    }).render('#paypal-button-container');
  });
</script>

</body>
</html>
